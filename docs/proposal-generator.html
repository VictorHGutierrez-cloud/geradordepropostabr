<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factorial - Gerador de Propostas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .factorial-brand { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .module-card { transition: all 0.3s ease; cursor: pointer; }
        .module-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }
        .module-card.selected { 
            border-color: #2563EB;
            background-color: #EFF6FF;
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.2);
        }
        .status-message { position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 8px; color: white; font-weight: bold; z-index: 1000; opacity: 0; transition: opacity 0.3s ease; }
        .status-message.show { opacity: 1; }
        .status-success { background-color: #10B981; }
        .status-error { background-color: #EF4444; }
    </style>
</head>
<body class="p-6">
    <!-- Status Messages -->
    <div id="statusMessage" class="status-message"></div>

    <div class="max-w-6xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden">
        <!-- Header -->
        <div class="factorial-brand text-white p-8">
            <h1 class="text-4xl font-bold mb-2">FACTORIAL</h1>
            <h2 class="text-2xl font-light">Gerador de Propostas Executivas</h2>
            <p class="text-purple-100 mt-2">Selecione os m√≥dulos e gere sua proposta</p>
        </div>

        <!-- Formul√°rio B√°sico -->
        <div class="p-8 border-b">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">üìã Informa√ß√µes do Cliente</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Empresa</label>
                    <input type="text" id="companyName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Ex: TechCorp">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Contato Principal</label>
                    <input type="text" id="contactName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Nome do tomador de decis√£o">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cargo</label>
                    <input type="text" id="contactRole" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Ex: CEO, CTO, HR Manager">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero de Funcion√°rios</label>
                    <input type="number" id="employeeCount" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Ex: 150">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Regi√£o</label>
                    <select id="region" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="">Selecione a regi√£o</option>
                        <option value="brasil">Brasil</option>
                        <option value="mexico">M√©xico</option>
                        <option value="espanha">Espanha</option>
                        <option value="franca">Fran√ßa</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Desconto (%)</label>
                    <input type="number" id="discount" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="0" min="0" max="50">
                </div>
            </div>
        </div>

        <!-- Sele√ß√£o de M√≥dulos -->
        <div class="p-8 border-b">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">üéØ Selecione os M√≥dulos Factorial</h3>
            
            <!-- M√≥dulos Core -->
            <div class="mb-8">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">üì¶ M√≥dulos Core (Obrigat√≥rios)</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="core-hr" data-price="2.50">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3" checked disabled>
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">Gest√£o de RH B√°sica</h5>
                                <p class="text-sm text-gray-600">‚Ç¨2.50/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="core-time" data-price="1.00">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3" checked disabled>
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">Controle de Ponto</h5>
                                <p class="text-sm text-gray-600">‚Ç¨1.00/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

            <!-- M√≥dulos Avan√ßados -->
            <div class="mb-8">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">üöÄ M√≥dulos Avan√ßados</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="advanced-reports" data-price="0.50">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3 module-checkbox">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">Relat√≥rios Avan√ßados</h5>
                                <p class="text-sm text-gray-600">‚Ç¨0.50/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="integrations" data-price="1.50">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3 module-checkbox">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">Integra√ß√µes</h5>
                                <p class="text-sm text-gray-600">‚Ç¨1.50/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="analytics" data-price="1.00">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3 module-checkbox">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">Analytics & BI</h5>
                                <p class="text-sm text-gray-600">‚Ç¨1.00/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="mobile-app" data-price="0.75">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3 module-checkbox">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">App Mobile</h5>
                                <p class="text-sm text-gray-600">‚Ç¨0.75/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

            <!-- M√≥dulos Premium -->
            <div class="mb-8">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">üíé M√≥dulos Premium</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="ai-insights" data-price="2.00">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3 module-checkbox">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">IA & Insights</h5>
                                <p class="text-sm text-gray-600">‚Ç¨2.00/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="custom-reports" data-price="1.25">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3 module-checkbox">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">Relat√≥rios Personalizados</h5>
                                <p class="text-sm text-gray-600">‚Ç¨1.25/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="api-access" data-price="0.50">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3 module-checkbox">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">API Access</h5>
                                <p class="text-sm text-gray-600">‚Ç¨0.50/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                    <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="white-label" data-price="3.00">
                        <div class="flex items-center">
                            <input type="checkbox" class="mr-3 module-checkbox">
                            <div class="flex-1">
                                <h5 class="font-semibold text-gray-800">White Label</h5>
                                <p class="text-sm text-gray-600">‚Ç¨3.00/funcion√°rio/m√™s</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Servi√ßos de Implementa√ß√£o -->
        <div class="p-8 border-b">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">üõ†Ô∏è Servi√ßos de Implementa√ß√£o</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="setup" data-price="500">
                    <div class="flex items-center">
                        <input type="checkbox" class="mr-3 module-checkbox">
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-800">Setup Inicial</h5>
                            <p class="text-sm text-gray-600">‚Ç¨500 (valor √∫nico)</p>
                        </div>
                    </div>
                </div>
                <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="migration" data-price="1000">
                    <div class="flex items-center">
                        <input type="checkbox" class="mr-3 module-checkbox">
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-800">Migra√ß√£o de Dados</h5>
                            <p class="text-sm text-gray-600">‚Ç¨1.000 (valor √∫nico)</p>
                        </div>
                    </div>
                </div>
                <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="training" data-price="750">
                    <div class="flex items-center">
                        <input type="checkbox" class="mr-3 module-checkbox">
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-800">Treinamento da Equipe</h5>
                            <p class="text-sm text-gray-600">‚Ç¨750 (valor √∫nico)</p>
                        </div>
                    </div>
                </div>
                <div class="module-card p-4 rounded-lg border-2 border-gray-200 bg-white" data-module="consulting" data-price="2000">
                    <div class="flex items-center">
                        <input type="checkbox" class="mr-3 module-checkbox">
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-800">Consultoria Estrat√©gica</h5>
                            <p class="text-sm text-gray-600">‚Ç¨2.000 (valor √∫nico)</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumo Executivo -->
        <div class="p-8 bg-gray-50">
            <h3 class="text-2xl font-semibold mb-6 text-gray-800">üí∞ Resumo Executivo</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Resumo Mensal -->
                <div class="bg-white p-6 rounded-lg border">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">üìä Custo Mensal</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">M√≥dulos Selecionados:</span>
                            <span id="selectedModules" class="font-semibold">‚Ç¨0.00/m√™s</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Por Funcion√°rio:</span>
                            <span id="pricePerEmployee" class="font-semibold">‚Ç¨0.00/m√™s</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Mensal:</span>
                            <span id="totalMonthly" class="font-semibold text-xl text-blue-600">‚Ç¨0.00/m√™s</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Anual:</span>
                            <span id="totalYearly" class="font-semibold text-xl text-green-600">‚Ç¨0.00/ano</span>
                        </div>
                    </div>
                </div>

                <!-- Resumo Implementa√ß√£o -->
                <div class="bg-white p-6 rounded-lg border">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">üõ†Ô∏è Custo de Implementa√ß√£o</h4>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Servi√ßos Selecionados:</span>
                            <span id="selectedServices" class="font-semibold">‚Ç¨0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Desconto:</span>
                            <span id="discountAmount" class="font-semibold text-red-600">‚Ç¨0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Implementa√ß√£o:</span>
                            <span id="totalImplementation" class="font-semibold text-xl text-purple-600">‚Ç¨0.00</span>
                        </div>
                        <div class="flex justify-between border-t pt-3">
                            <span class="text-gray-800 font-semibold">TOTAL GERAL:</span>
                            <span id="totalGeneral" class="font-bold text-2xl text-red-600">‚Ç¨0.00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bot√µes -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                <button id="previewProposal" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-lg transition duration-200">
                    üëÅÔ∏è Visualizar Proposta
                </button>
                <button id="generateProposal" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-8 rounded-lg transition duration-200">
                    üìÑ Gerar Proposta HTML
                </button>
                <button id="exportPDF" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg transition duration-200">
                    üìã Exportar PDF
                </button>
                <button id="clearSelection" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-8 rounded-lg transition duration-200">
                    üóëÔ∏è Limpar Sele√ß√£o
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Preview -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden">
                <div class="flex justify-between items-center p-4 border-b">
                    <h3 class="text-xl font-semibold">Preview da Proposta Executiva</h3>
                    <button id="closeModal" class="text-gray-500 hover:text-gray-700">‚úï</button>
                </div>
                <div class="p-4 overflow-y-auto max-h-[calc(90vh-80px)]">
                    <div id="proposalPreview"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados dos m√≥dulos
        const modules = {
            'core-hr': { name: 'Gest√£o de RH B√°sica', price: 2.50, type: 'monthly' },
            'core-time': { name: 'Controle de Ponto', price: 1.00, type: 'monthly' },
            'advanced-reports': { name: 'Relat√≥rios Avan√ßados', price: 0.50, type: 'monthly' },
            'integrations': { name: 'Integra√ß√µes', price: 1.50, type: 'monthly' },
            'analytics': { name: 'Analytics & BI', price: 1.00, type: 'monthly' },
            'mobile-app': { name: 'App Mobile', price: 0.75, type: 'monthly' },
            'ai-insights': { name: 'IA & Insights', price: 2.00, type: 'monthly' },
            'custom-reports': { name: 'Relat√≥rios Personalizados', price: 1.25, type: 'monthly' },
            'api-access': { name: 'API Access', price: 0.50, type: 'monthly' },
            'white-label': { name: 'White Label', price: 3.00, type: 'monthly' },
            'setup': { name: 'Setup Inicial', price: 500, type: 'one-time' },
            'migration': { name: 'Migra√ß√£o de Dados', price: 1000, type: 'one-time' },
            'training': { name: 'Treinamento da Equipe', price: 750, type: 'one-time' },
            'consulting': { name: 'Consultoria Estrat√©gica', price: 2000, type: 'one-time' }
        };

        let selectedModules = new Set(['core-hr', 'core-time']); // M√≥dulos obrigat√≥rios

        // Fun√ß√£o para mostrar mensagens
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type} show`;
            setTimeout(() => statusEl.classList.remove('show'), 3000);
        }

        // Fun√ß√£o para configurar event listeners
        function setupEventListeners() {
            // Sele√ß√£o de m√≥dulos
            document.querySelectorAll('.module-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const moduleCard = this.closest('.module-card');
                    const moduleId = moduleCard.dataset.module;
                    
                    if (this.checked) {
                        selectedModules.add(moduleId);
                        moduleCard.classList.add('selected');
                    } else {
                        selectedModules.delete(moduleId);
                        moduleCard.classList.remove('selected');
                    }
                    
                    calculateTotal();
                });
            });

            // Adicionar event listeners para inputs
            document.getElementById('employeeCount').addEventListener('input', calculateTotal);
            document.getElementById('discount').addEventListener('input', calculateTotal);
        }

        // Fun√ß√£o principal de c√°lculo (baseada no seu exemplo)
        function calculateTotal() {
            console.log('üßÆ calculateTotal chamada!');
            const employeeCount = parseInt(document.getElementById('employeeCount').value) || 0;
            const discount = parseInt(document.getElementById('discount').value) || 0;
            
            console.log('üë• Funcion√°rios:', employeeCount, 'üí∞ Desconto:', discount, '%');
            
            if (employeeCount === 0) {
                // Limpar valores se n√£o h√° funcion√°rios
                document.getElementById('selectedModules').textContent = '‚Ç¨0.00/m√™s';
                document.getElementById('pricePerEmployee').textContent = '‚Ç¨0.00/m√™s';
                document.getElementById('totalMonthly').textContent = '‚Ç¨0.00/m√™s';
                document.getElementById('totalYearly').textContent = '‚Ç¨0.00/ano';
                document.getElementById('selectedServices').textContent = '‚Ç¨0.00';
                document.getElementById('discountAmount').textContent = '‚Ç¨0.00';
                document.getElementById('totalImplementation').textContent = '‚Ç¨0.00';
                document.getElementById('totalGeneral').textContent = '‚Ç¨0.00';
                return;
            }
            
            // Calcular custos mensais
            let monthlyCost = 0;
            let oneTimeCost = 0;
            let selectedModulesList = [];
            let selectedServicesList = [];
            
            selectedModules.forEach(moduleId => {
                const module = modules[moduleId];
                if (module.type === 'monthly') {
                    monthlyCost += module.price;
                    selectedModulesList.push(module.name);
                } else {
                    oneTimeCost += module.price;
                    selectedServicesList.push(module.name);
                }
            });
            
            // Aplicar desconto
            const finalMonthlyCost = monthlyCost * (1 - discount / 100);
            const totalMonthly = finalMonthlyCost * employeeCount;
            const totalYearly = totalMonthly * 12;
            const finalOneTimeCost = oneTimeCost * (1 - discount / 100);
            const discountAmount = (monthlyCost + oneTimeCost) * (discount / 100);
            const totalGeneral = totalYearly + finalOneTimeCost;
            
            // Atualizar interface com anima√ß√£o
            updateValueWithAnimation('selectedModules', `‚Ç¨${finalMonthlyCost.toFixed(2)}/m√™s`);
            updateValueWithAnimation('pricePerEmployee', `‚Ç¨${finalMonthlyCost.toFixed(2)}/m√™s`);
            updateValueWithAnimation('totalMonthly', `‚Ç¨${totalMonthly.toFixed(2)}/m√™s`);
            updateValueWithAnimation('totalYearly', `‚Ç¨${totalYearly.toFixed(2)}/ano`);
            updateValueWithAnimation('selectedServices', `‚Ç¨${oneTimeCost.toFixed(2)}`);
            updateValueWithAnimation('discountAmount', `-‚Ç¨${discountAmount.toFixed(2)}`);
            updateValueWithAnimation('totalImplementation', `‚Ç¨${finalOneTimeCost.toFixed(2)}`);
            updateValueWithAnimation('totalGeneral', `‚Ç¨${totalGeneral.toFixed(2)}`);
            
            // Mostrar status
            if (selectedModules.size > 2) { // Mais que os obrigat√≥rios
                showStatus(`‚úÖ ${selectedModules.size} m√≥dulos selecionados - Total: ‚Ç¨${totalGeneral.toFixed(2)}`, 'success');
            }
        }

        // Fun√ß√£o para animar mudan√ßas de valores
        function updateValueWithAnimation(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.style.transition = 'all 0.3s ease';
                element.textContent = newValue;
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // Visualizar proposta
        function previewProposal() {
            const formData = getFormData();
            if (!validateForm(formData)) return;

            const proposalHTML = createProposalHTML(formData);
            
            // Mostrar no modal
            const modal = document.getElementById('previewModal');
            const iframe = document.getElementById('proposalPreviewFrame');
            iframe.srcdoc = proposalHTML;
            modal.classList.remove('hidden');
            
            showStatus('üëÅÔ∏è Proposta visualizada no modal!', 'success');
        }

        // Gerar proposta
        function generateProposal() {
            const formData = getFormData();
            if (!validateForm(formData)) return;

            const proposalHTML = createProposalHTML(formData);
            
            // Criar e baixar arquivo
            const blob = new Blob([proposalHTML], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `proposta-executiva-factorial-${formData.companyName.toLowerCase().replace(/\s+/g, '-')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('‚úÖ Proposta HTML baixada com sucesso!', 'success');
        }

        // Exportar PDF
        async function exportPDF() {
            const formData = getFormData();
            if (!validateForm(formData)) return;

            try {
                showStatus('üìÑ Gerando PDF...', 'success');
                
                const proposalHTML = createProposalHTML(formData);
                const tempContainer = document.createElement('div');
                tempContainer.innerHTML = proposalHTML;
                tempContainer.style.position = 'absolute';
                tempContainer.style.left = '-9999px';
                tempContainer.style.top = '0';
                tempContainer.style.width = '210mm';
                tempContainer.style.backgroundColor = 'white';
                document.body.appendChild(tempContainer);

                await new Promise(resolve => setTimeout(resolve, 1000));

                const canvas = await html2canvas(tempContainer, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: 794,
                    height: tempContainer.scrollHeight
                });

                document.body.removeChild(tempContainer);

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                const fileName = `proposta-executiva-factorial-${formData.companyName.toLowerCase().replace(/\s+/g, '-')}.pdf`;
                pdf.save(fileName);
                
                showStatus('‚úÖ PDF gerado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showStatus('‚ùå Erro ao gerar PDF. Tente novamente.', 'error');
            }
        }

        // Limpar sele√ß√£o
        function clearSelection() {
            selectedModules.clear();
            selectedModules.add('core-hr');
            selectedModules.add('core-time');
            
            document.querySelectorAll('.module-checkbox').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.module-card').classList.remove('selected');
            });
            
            document.getElementById('employeeCount').value = '';
            document.getElementById('discount').value = '';
            
            calculateTotal();
            showStatus('üóëÔ∏è Sele√ß√£o limpa!', 'success');
        }

        // Obter dados do formul√°rio
        function getFormData() {
            return {
                companyName: document.getElementById('companyName').value,
                contactName: document.getElementById('contactName').value,
                contactRole: document.getElementById('contactRole').value,
                employeeCount: parseInt(document.getElementById('employeeCount').value) || 0,
                region: document.getElementById('region').value,
                discount: parseInt(document.getElementById('discount').value) || 0,
                selectedModules: Array.from(selectedModules)
            };
        }

        // Validar formul√°rio
        function validateForm(data) {
            if (!data.companyName) {
                showStatus('‚ùå Por favor, preencha o nome da empresa', 'error');
                return false;
            }
            if (!data.employeeCount || data.employeeCount <= 0) {
                showStatus('‚ùå Por favor, informe o n√∫mero de funcion√°rios', 'error');
                return false;
            }
            return true;
        }

        // Criar HTML da proposta
        function createProposalHTML(data) {
            const employeeCount = data.employeeCount;
            const discount = data.discount;
            
            // Calcular custos
            let monthlyCost = 0;
            let oneTimeCost = 0;
            let selectedModulesList = [];
            let selectedServicesList = [];
            
            data.selectedModules.forEach(moduleId => {
                const module = modules[moduleId];
                if (module.type === 'monthly') {
                    monthlyCost += module.price;
                    selectedModulesList.push(module.name);
                } else {
                    oneTimeCost += module.price;
                    selectedServicesList.push(module.name);
                }
            });
            
            const finalMonthlyCost = monthlyCost * (1 - discount / 100);
            const totalMonthly = finalMonthlyCost * employeeCount;
            const totalYearly = totalMonthly * 12;
            const finalOneTimeCost = oneTimeCost * (1 - discount / 100);
            const totalGeneral = totalYearly + finalOneTimeCost;
            
            return `
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposta Executiva Factorial - ${data.companyName}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .factorial-brand { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto bg-white shadow-lg">
        <!-- Header -->
        <div class="factorial-brand text-white p-8">
            <h1 class="text-4xl font-bold mb-2">FACTORIAL</h1>
            <h2 class="text-2xl font-light">Proposta Executiva</h2>
            <p class="text-purple-100 mt-2">${data.companyName} - ${data.region.toUpperCase()}</p>
        </div>

        <!-- Dados do Cliente -->
        <div class="p-8 border-b">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800">üìã Informa√ß√µes do Cliente</h3>
            <div class="grid grid-cols-2 gap-4 text-gray-700">
                <div><strong>Empresa:</strong> ${data.companyName}</div>
                <div><strong>Contato:</strong> ${data.contactName}</div>
                <div><strong>Cargo:</strong> ${data.contactRole}</div>
                <div><strong>Funcion√°rios:</strong> ${data.employeeCount}</div>
                <div><strong>Regi√£o:</strong> ${data.region.toUpperCase()}</div>
                <div><strong>Data:</strong> ${new Date().toLocaleDateString('pt-BR')}</div>
            </div>
        </div>

        <!-- M√≥dulos Selecionados -->
        <div class="p-8 border-b">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800">üéØ M√≥dulos Selecionados</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h4 class="text-lg font-semibold text-gray-800 mb-2">M√≥dulos Mensais</h4>
                    <ul class="space-y-1 text-gray-700">
                        ${selectedModulesList.map(module => `<li>‚úì ${module}</li>`).join('')}
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-semibold text-gray-800 mb-2">Servi√ßos de Implementa√ß√£o</h4>
                    <ul class="space-y-1 text-gray-700">
                        ${selectedServicesList.length > 0 ? selectedServicesList.map(service => `<li>‚úì ${service}</li>`).join('') : '<li>Nenhum servi√ßo selecionado</li>'}
                    </ul>
                </div>
            </div>
        </div>

        <!-- Resumo Financeiro -->
        <div class="p-8 border-b">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800">üí∞ Resumo Financeiro</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-blue-800 mb-4">Custos Mensais</h4>
                    <div class="space-y-2 text-gray-700">
                        <div class="flex justify-between">
                            <span>Pre√ßo por funcion√°rio:</span>
                            <span class="font-semibold">‚Ç¨${finalMonthlyCost.toFixed(2)}/m√™s</span>
                    </div>
                        <div class="flex justify-between">
                            <span>Total mensal:</span>
                            <span class="font-semibold">‚Ç¨${totalMonthly.toFixed(2)}/m√™s</span>
                    </div>
                        <div class="flex justify-between">
                            <span>Total anual:</span>
                            <span class="font-semibold text-blue-600">‚Ç¨${totalYearly.toFixed(2)}/ano</span>
        </div>
                    </div>
                </div>
                <div class="bg-green-50 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold text-green-800 mb-4">Custos de Implementa√ß√£o</h4>
                    <div class="space-y-2 text-gray-700">
                        <div class="flex justify-between">
                            <span>Servi√ßos selecionados:</span>
                            <span class="font-semibold">‚Ç¨${oneTimeCost.toFixed(2)}</span>
                    </div>
                        ${discount > 0 ? `
                        <div class="flex justify-between">
                            <span>Desconto (${discount}%):</span>
                            <span class="font-semibold text-red-600">-‚Ç¨${(oneTimeCost * discount / 100).toFixed(2)}</span>
                </div>
                        ` : ''}
                        <div class="flex justify-between">
                            <span>Total implementa√ß√£o:</span>
                            <span class="font-semibold text-green-600">‚Ç¨${finalOneTimeCost.toFixed(2)}</span>
                </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 bg-red-50 p-6 rounded-lg">
                <div class="flex justify-between items-center">
                    <span class="text-xl font-semibold text-red-800">TOTAL GERAL (Primeiro Ano):</span>
                    <span class="text-3xl font-bold text-red-600">‚Ç¨${totalGeneral.toFixed(2)}</span>
                </div>
            </div>
        </div>

        <!-- Pr√≥ximos Passos -->
        <div class="p-8 bg-gray-50">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800">üöÄ Pr√≥ximos Passos</h3>
            <p class="text-gray-700 mb-6">Estamos prontos para implementar a solu√ß√£o Factorial na ${data.companyName}.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center p-4 bg-white rounded-lg">
                    <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-3">
                        <span class="text-white font-bold">1</span>
                    </div>
                    <h4 class="font-semibold text-gray-800 mb-2">Aprova√ß√£o</h4>
                    <p class="text-sm text-gray-600">Aprova√ß√£o da proposta em at√© 7 dias</p>
                </div>
                <div class="text-center p-4 bg-white rounded-lg">
                    <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-3">
                        <span class="text-white font-bold">2</span>
                    </div>
                    <h4 class="font-semibold text-gray-800 mb-2">Implementa√ß√£o</h4>
                    <p class="text-sm text-gray-600">In√≠cio em 2 semanas ap√≥s aprova√ß√£o</p>
                </div>
                <div class="text-center p-4 bg-white rounded-lg">
                    <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-3">
                        <span class="text-white font-bold">3</span>
                    </div>
                    <h4 class="font-semibold text-gray-800 mb-2">Go-Live</h4>
                    <p class="text-sm text-gray-600">Sistema funcionando em 4 semanas</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="p-8 factorial-brand text-white text-center">
            <h4 class="text-xl font-bold mb-2">FACTORIAL</h4>
            <p class="text-purple-100">Transformando a gest√£o de RH em empresas modernas</p>
            <p class="text-sm text-purple-200 mt-2">Proposta gerada em ${new Date().toLocaleDateString('pt-BR')}</p>
        </div>
    </div>
</body>
</html>`;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar todos os event listeners
            setupEventListeners();
            
            // Bot√µes principais
            document.getElementById('previewProposal').addEventListener('click', previewProposal);
            document.getElementById('generateProposal').addEventListener('click', generateProposal);
            document.getElementById('exportPDF').addEventListener('click', exportPDF);
            document.getElementById('clearSelection').addEventListener('click', clearSelection);
            
            // Marcar m√≥dulos obrigat√≥rios como selecionados
            document.querySelectorAll('[data-module="core-hr"], [data-module="core-time"]').forEach(card => {
                card.classList.add('selected');
            });
            
            // Calcular valores iniciais
            calculateTotal();
            showStatus('üéØ Sistema carregado! Selecione os m√≥dulos e veja o c√°lculo autom√°tico!', 'success');
        });
    </script>
</body>
</html>