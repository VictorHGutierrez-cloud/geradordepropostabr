<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcritor de Reuni√µes - Distribusion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .recording {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .transcript-item {
            transition: all 0.3s ease;
        }
        .transcript-item:hover {
            background-color: #f8fafc;
        }
        .speaker-ai {
            background-color: #EFF6FF;
            border-left: 4px solid #2563EB;
        }
        .speaker-user {
            background-color: #F0FDF4;
            border-left: 4px solid #10B981;
        }
        .speaker-client {
            background-color: #FEF3C7;
            border-left: 4px solid #F59E0B;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-8 rounded-lg mb-6">
            <h1 class="text-4xl font-bold mb-2">DISTRIBUSION</h1>
            <h2 class="text-2xl font-light">Transcritor de Reuni√µes com IA</h2>
            <p class="text-blue-100 mt-2">Transforme suas reuni√µes em propostas automatizadas</p>
        </div>

        <!-- Recording Controls -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800">üé§ Grava√ß√£o de Reuni√£o</h3>
            
            <div class="flex items-center justify-center space-x-6 mb-6">
                <button id="startRecording" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-4 px-8 rounded-full transition duration-200 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                    </svg>
                    Iniciar Grava√ß√£o
                </button>
                
                <button id="stopRecording" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-4 px-8 rounded-full transition duration-200 flex items-center hidden">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                    </svg>
                    Parar Grava√ß√£o
                </button>
                
                <button id="pauseRecording" class="bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-4 px-8 rounded-full transition duration-200 flex items-center hidden">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Pausar
                </button>
            </div>

            <!-- Recording Status -->
            <div id="recordingStatus" class="text-center hidden">
                <div class="inline-flex items-center px-4 py-2 bg-red-100 text-red-800 rounded-full recording">
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                    Gravando... <span id="recordingTime">00:00</span>
                </div>
            </div>

            <!-- Audio Upload Alternative -->
            <div class="border-t pt-6 mt-6">
                <h4 class="text-lg font-semibold mb-4 text-gray-800">Ou fa√ßa upload de um arquivo de √°udio</h4>
                <div class="flex items-center space-x-4">
                    <input type="file" id="audioFile" accept="audio/*" class="hidden">
                    <button id="selectAudioFile" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition duration-200">
                        Selecionar Arquivo de √Åudio
                    </button>
                    <span id="selectedFileName" class="text-gray-600"></span>
                </div>
            </div>
        </div>

        <!-- Transcription Results -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-semibold text-gray-800">üìù Transcri√ß√£o da Reuni√£o</h3>
                <div class="flex space-x-2">
                    <button id="processTranscription" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                        Processar com IA
                    </button>
                    <button id="clearTranscription" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                        Limpar
                    </button>
                </div>
            </div>

            <!-- Transcription Text -->
            <div id="transcriptionText" class="min-h-64 p-4 border border-gray-300 rounded-lg bg-gray-50">
                <p class="text-gray-500 text-center">A transcri√ß√£o aparecer√° aqui ap√≥s a grava√ß√£o ou upload do arquivo...</p>
            </div>

            <!-- AI Processing Status -->
            <div id="aiProcessing" class="hidden mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-center">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-3"></div>
                    <span class="text-blue-800">Processando transcri√ß√£o com IA...</span>
                </div>
            </div>
        </div>

        <!-- Extracted Information -->
        <div id="extractedInfo" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800">üéØ Informa√ß√µes Extra√≠das</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Client Information -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-gray-700">Informa√ß√µes do Cliente</h4>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Empresa</label>
                        <input type="text" id="extractedCompany" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contato Principal</label>
                        <input type="text" id="extractedContact" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Volume Mensal</label>
                        <input type="number" id="extractedVolume" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <!-- Pain Points -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-gray-700">Dores Identificadas</h4>
                    <div id="painPoints" class="space-y-2">
                        <!-- Pain points will be dynamically added here -->
                    </div>
                    <button id="addPainPoint" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                        + Adicionar dor
                    </button>
                </div>
            </div>

            <!-- Requirements -->
            <div class="mt-6">
                <h4 class="text-lg font-semibold text-gray-700 mb-4">Requisitos Identificados</h4>
                <div id="requirements" class="space-y-2">
                    <!-- Requirements will be dynamically added here -->
                </div>
                <button id="addRequirement" class="text-blue-600 hover:text-blue-800 text-sm font-medium mt-2">
                    + Adicionar requisito
                </button>
            </div>
        </div>

        <!-- Generate Proposal Button -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="text-center">
                <button id="generateProposalFromMeeting" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-4 px-8 rounded-lg transition duration-200 flex items-center mx-auto">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Gerar Proposta Automatizada
                </button>
                <p class="text-gray-600 mt-2">Baseada nas informa√ß√µes extra√≠das da reuni√£o</p>
            </div>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let recordingStartTime;
        let recordingTimer;
        let transcriptionData = '';

        // DOM elements
        const startBtn = document.getElementById('startRecording');
        const stopBtn = document.getElementById('stopRecording');
        const pauseBtn = document.getElementById('pauseRecording');
        const recordingStatus = document.getElementById('recordingStatus');
        const recordingTime = document.getElementById('recordingTime');
        const audioFile = document.getElementById('audioFile');
        const selectAudioFile = document.getElementById('selectAudioFile');
        const selectedFileName = document.getElementById('selectedFileName');
        const transcriptionText = document.getElementById('transcriptionText');
        const processBtn = document.getElementById('processTranscription');
        const clearBtn = document.getElementById('clearTranscription');
        const aiProcessing = document.getElementById('aiProcessing');
        const extractedInfo = document.getElementById('extractedInfo');
        const generateProposalBtn = document.getElementById('generateProposalFromMeeting');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            startBtn.addEventListener('click', startRecording);
            stopBtn.addEventListener('click', stopRecording);
            pauseBtn.addEventListener('click', pauseRecording);
            selectAudioFile.addEventListener('click', () => audioFile.click());
            audioFile.addEventListener('change', handleAudioFile);
            processBtn.addEventListener('click', processTranscription);
            clearBtn.addEventListener('click', clearTranscription);
            generateProposalBtn.addEventListener('click', generateProposalFromMeeting);
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    processAudioBlob(audioBlob);
                };

                mediaRecorder.start();
                isRecording = true;
                recordingStartTime = Date.now();

                // Update UI
                startBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
                pauseBtn.classList.remove('hidden');
                recordingStatus.classList.remove('hidden');

                // Start timer
                recordingTimer = setInterval(updateRecordingTime, 1000);

                showNotification('Grava√ß√£o iniciada!', 'success');
            } catch (error) {
                console.error('Erro ao iniciar grava√ß√£o:', error);
                showNotification('Erro ao acessar o microfone. Verifique as permiss√µes.', 'error');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;

                // Update UI
                startBtn.classList.remove('hidden');
                stopBtn.classList.add('hidden');
                pauseBtn.classList.add('hidden');
                recordingStatus.classList.add('hidden');

                // Stop timer
                clearInterval(recordingTimer);

                showNotification('Grava√ß√£o finalizada!', 'success');
            }
        }

        function pauseRecording() {
            if (mediaRecorder && isRecording) {
                if (mediaRecorder.state === 'recording') {
                    mediaRecorder.pause();
                    pauseBtn.innerHTML = `
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"></path>
                        </svg>
                        Retomar
                    `;
                } else {
                    mediaRecorder.resume();
                    pauseBtn.innerHTML = `
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Pausar
                    `;
                }
            }
        }

        function updateRecordingTime() {
            const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            recordingTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function handleAudioFile(event) {
            const file = event.target.files[0];
            if (file) {
                selectedFileName.textContent = file.name;
                processAudioFile(file);
            }
        }

        function processAudioBlob(audioBlob) {
            // Simulate transcription processing
            transcriptionText.innerHTML = '<p class="text-blue-600">Processando √°udio gravado...</p>';
            
            // Simulate API call delay
            setTimeout(() => {
                const mockTranscription = generateMockTranscription();
                displayTranscription(mockTranscription);
            }, 2000);
        }

        function processAudioFile(file) {
            transcriptionText.innerHTML = '<p class="text-blue-600">Processando arquivo de √°udio...</p>';
            
            // Simulate API call delay
            setTimeout(() => {
                const mockTranscription = generateMockTranscription();
                displayTranscription(mockTranscription);
            }, 2000);
        }

        function generateMockTranscription() {
            return `
                [00:00] Vendedor: Ol√°! Obrigado por aceitar esta reuni√£o. Vou apresentar a solu√ß√£o da Distribusion para voc√™s.

                [00:15] Cliente: Ol√°! Estamos interessados em melhorar nossa integra√ß√£o de transporte terrestre. Atualmente temos muitos problemas com APIs fragmentadas.

                [00:30] Vendedor: Entendo perfeitamente. Quantas transa√ß√µes voc√™s processam por m√™s?

                [00:45] Cliente: Cerca de 15.000 transa√ß√µes mensais. O problema √© que temos que integrar com mais de 20 provedores diferentes, cada um com sua pr√≥pria API.

                [01:00] Vendedor: Isso √© exatamente o que resolvemos. Com a Distribusion, voc√™s teriam uma √∫nica integra√ß√£o para todos os provedores. Qual √© o volume de receita que voc√™s perdem com essa fragmenta√ß√£o?

                [01:15] Cliente: Estimamos que perdemos cerca de 15% de receita por passageiro devido √† complexidade. Al√©m disso, nossa equipe t√©cnica gasta muito tempo mantendo essas integra√ß√µes.

                [01:30] Vendedor: Perfeito! Nossa solu√ß√£o pode aumentar sua receita em 15%+ e reduzir o tempo de integra√ß√£o de 3-12 meses para apenas 2-4 semanas. Voc√™s t√™m alguma prefer√™ncia de regi√£o?

                [01:45] Cliente: Focamos principalmente na Europa, mas tamb√©m temos opera√ß√µes na APAC. Precisamos de uma solu√ß√£o que funcione globalmente.

                [02:00] Vendedor: Excelente! Nossa plataforma tem cobertura global. Vamos agendar um POC de 90 dias para validar a integra√ß√£o?
            `;
        }

        function displayTranscription(text) {
            transcriptionData = text;
            transcriptionText.innerHTML = `
                <div class="space-y-4">
                    ${text.split('\n').filter(line => line.trim()).map(line => {
                        if (line.includes('[00:') && line.includes(']')) {
                            const parts = line.split('] ');
                            const time = parts[0] + ']';
                            const speaker = parts[1].split(': ')[0];
                            const content = parts[1].split(': ').slice(1).join(': ');
                            
                            let speakerClass = 'speaker-user';
                            if (speaker.includes('Vendedor')) speakerClass = 'speaker-ai';
                            if (speaker.includes('Cliente')) speakerClass = 'speaker-client';
                            
                            return `
                                <div class="transcript-item p-3 rounded-lg ${speakerClass}">
                                    <div class="flex justify-between items-start mb-1">
                                        <span class="font-semibold text-sm">${speaker}</span>
                                        <span class="text-xs text-gray-500">${time}</span>
                                    </div>
                                    <p class="text-gray-800">${content}</p>
                                </div>
                            `;
                        }
                        return '';
                    }).join('')}
                </div>
            `;
        }

        function processTranscription() {
            if (!transcriptionData) {
                showNotification('Nenhuma transcri√ß√£o dispon√≠vel para processar.', 'error');
                return;
            }

            aiProcessing.classList.remove('hidden');
            
            // Simulate AI processing
            setTimeout(() => {
                aiProcessing.classList.add('hidden');
                extractInformation();
                showNotification('Transcri√ß√£o processada com IA!', 'success');
            }, 3000);
        }

        function extractInformation() {
            // Extract company information (mock)
            document.getElementById('extractedCompany').value = 'TechTravel Solutions';
            document.getElementById('extractedContact').value = 'Jo√£o Silva - CTO';
            document.getElementById('extractedVolume').value = '15000';

            // Extract pain points
            const painPointsContainer = document.getElementById('painPoints');
            painPointsContainer.innerHTML = `
                <div class="flex items-center space-x-2">
                    <input type="text" value="APIs fragmentadas (20+ provedores)" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <button class="text-red-600 hover:text-red-800" onclick="this.parentElement.remove()">√ó</button>
                </div>
                <div class="flex items-center space-x-2">
                    <input type="text" value="Perda de 15% de receita por passageiro" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <button class="text-red-600 hover:text-red-800" onclick="this.parentElement.remove()">√ó</button>
                </div>
                <div class="flex items-center space-x-2">
                    <input type="text" value="Tempo excessivo de manuten√ß√£o t√©cnica" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <button class="text-red-600 hover:text-red-800" onclick="this.parentElement.remove()">√ó</button>
                </div>
            `;

            // Extract requirements
            const requirementsContainer = document.getElementById('requirements');
            requirementsContainer.innerHTML = `
                <div class="flex items-center space-x-2">
                    <input type="text" value="Integra√ß√£o √∫nica para m√∫ltiplos provedores" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <button class="text-red-600 hover:text-red-800" onclick="this.parentElement.remove()">√ó</button>
                </div>
                <div class="flex items-center space-x-2">
                    <input type="text" value="Cobertura global (Europa + APAC)" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <button class="text-red-600 hover:text-red-800" onclick="this.parentElement.remove()">√ó</button>
                </div>
                <div class="flex items-center space-x-2">
                    <input type="text" value="Aumento de receita de 15%+" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <button class="text-red-600 hover:text-red-800" onclick="this.parentElement.remove()">√ó</button>
                </div>
            `;

            extractedInfo.classList.remove('hidden');

            // Setup add buttons
            document.getElementById('addPainPoint').onclick = addPainPoint;
            document.getElementById('addRequirement').onclick = addRequirement;
        }

        function addPainPoint() {
            const container = document.getElementById('painPoints');
            const div = document.createElement('div');
            div.className = 'flex items-center space-x-2';
            div.innerHTML = `
                <input type="text" placeholder="Nova dor identificada" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <button class="text-red-600 hover:text-red-800" onclick="this.parentElement.remove()">√ó</button>
            `;
            container.appendChild(div);
        }

        function addRequirement() {
            const container = document.getElementById('requirements');
            const div = document.createElement('div');
            div.className = 'flex items-center space-x-2';
            div.innerHTML = `
                <input type="text" placeholder="Novo requisito" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                <button class="text-red-600 hover:text-red-800" onclick="this.parentElement.remove()">√ó</button>
            `;
            container.appendChild(div);
        }

        function clearTranscription() {
            transcriptionData = '';
            transcriptionText.innerHTML = '<p class="text-gray-500 text-center">A transcri√ß√£o aparecer√° aqui ap√≥s a grava√ß√£o ou upload do arquivo...</p>';
            extractedInfo.classList.add('hidden');
            selectedFileName.textContent = '';
            audioFile.value = '';
        }

        function generateProposalFromMeeting() {
            // Collect extracted information
            const companyName = document.getElementById('extractedCompany').value;
            const contactName = document.getElementById('extractedContact').value;
            const monthlyVolume = document.getElementById('extractedVolume').value;

            if (!companyName || !contactName || !monthlyVolume) {
                showNotification('Por favor, preencha todas as informa√ß√µes do cliente.', 'error');
                return;
            }

            // Collect pain points
            const painPoints = Array.from(document.querySelectorAll('#painPoints input')).map(input => input.value).filter(value => value.trim());

            // Collect requirements
            const requirements = Array.from(document.querySelectorAll('#requirements input')).map(input => input.value).filter(value => value.trim());

            // Store data in localStorage for proposal generator
            const meetingData = {
                companyName,
                contactName,
                monthlyVolume,
                painPoints,
                requirements,
                transcription: transcriptionData,
                extractedDate: new Date().toISOString()
            };

            localStorage.setItem('lastMeetingData', JSON.stringify(meetingData));

            // Open proposal generator
            window.open('proposal-generator-fixed.html', '_blank');
            showNotification('Dados da reuni√£o enviados para o gerador de propostas!', 'success');
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white font-semibold z-50 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
